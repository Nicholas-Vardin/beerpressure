<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Profile - Beer Pressure</title>
        <link href="https://fonts.googleapis.com/css2?family=Irish+Grover&display=swap" rel="stylesheet">
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: Arial, sans-serif;
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                min-height: 100vh;
            }

            header {
                background: #333;
                color: white;
                padding: 15px 30px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            }

            header h2 {
                margin: 0;
                font-size: 24px;
                cursor: pointer;
            }

            #userInfo {
                display: flex;
                align-items: center;
                gap: 15px;
            }

            #userInfo img {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                border: 2px solid white;
            }

            #userInfo button {
                background: #ff4444;
                color: white;
                border: none;
                padding: 8px 16px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 14px;
            }

            .profile-container {
                max-width: 800px;
                margin: 40px auto;
                padding: 20px;
            }

            .profile-card {
                background: white;
                border-radius: 12px;
                padding: 40px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                margin-bottom: 20px;
            }

            .profile-header {
                text-align: center;
                margin-bottom: 40px;
                padding-bottom: 30px;
                border-bottom: 2px solid #f0f0f0;
            }

            .profile-pic-large {
                width: 120px;
                height: 120px;
                border-radius: 50%;
                border: 4px solid #ff6b35;
                margin-bottom: 20px;
            }

            .profile-header h1 {
                font-family: 'Irish Grover', cursive;
                color: #ff6b35;
                margin-bottom: 10px;
            }

            .profile-header p {
                color: #666;
                font-size: 16px;
            }

            .profile-section {
                margin-bottom: 30px;
            }

            .profile-section h2 {
                color: #333;
                font-size: 20px;
                margin-bottom: 20px;
                padding-bottom: 10px;
                border-bottom: 2px solid #f0f0f0;
            }

            .info-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 15px 0;
                border-bottom: 1px solid #f0f0f0;
            }

            .info-row:last-child {
                border-bottom: none;
            }

            .info-label {
                font-weight: bold;
                color: #555;
                font-size: 14px;
            }

            .info-value {
                color: #333;
                font-size: 14px;
            }

            .form-group {
                margin-bottom: 20px;
            }

            .form-group label {
                display: block;
                margin-bottom: 8px;
                color: #555;
                font-weight: bold;
                font-size: 14px;
            }

            .form-group input,
            .form-group textarea,
            .form-group select {
                width: 100%;
                padding: 12px;
                border: 2px solid #e0e0e0;
                border-radius: 6px;
                font-size: 14px;
                transition: border-color 0.3s;
            }

            .form-group input:focus,
            .form-group textarea:focus,
            .form-group select:focus {
                outline: none;
                border-color: #ff6b35;
            }

            .form-group textarea {
                resize: vertical;
                min-height: 80px;
            }

            .btn {
                padding: 12px 30px;
                border: none;
                border-radius: 6px;
                font-size: 16px;
                cursor: pointer;
                transition: all 0.3s;
                font-weight: bold;
            }

            .btn-primary {
                background: #ff6b35;
                color: white;
            }

            .btn-primary:hover {
                background: #ff5722;
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
            }

            .btn-secondary {
                background: #666;
                color: white;
                margin-left: 10px;
            }

            .btn-secondary:hover {
                background: #555;
            }

            .back-link {
                display: inline-block;
                color: white;
                text-decoration: none;
                margin-bottom: 20px;
                padding: 10px 20px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 6px;
                transition: background 0.3s;
            }

            .back-link:hover {
                background: rgba(255, 255, 255, 0.2);
            }

            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
                margin-top: 20px;
            }

            .stat-card {
                background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%);
                color: white;
                padding: 20px;
                border-radius: 8px;
                text-align: center;
            }

            .stat-number {
                font-size: 36px;
                font-weight: bold;
                margin-bottom: 5px;
            }

            .stat-label {
                font-size: 14px;
                opacity: 0.9;
            }

            .edit-mode {
                display: none;
            }

            .edit-mode.active {
                display: block;
            }

            .view-mode.hidden {
                display: none;
            }

            .success-message {
                background: #4caf50;
                color: white;
                padding: 15px;
                border-radius: 6px;
                margin-bottom: 20px;
                display: none;
            }

            .success-message.show {
                display: block;
            }
        </style>
    </head>
    <body>
        <header>
            <h2 onclick="window.location.href='index.html'" style="cursor: pointer;">Beer Pressure</h2>
            <div id="userInfo"></div>
        </header>

        <div class="profile-container">
            <a href="index.html" class="back-link">‚Üê Back to Dashboard</a>

            <div id="successMessage" class="success-message">
                Profile updated successfully!
            </div>

            <!-- Profile Card -->
            <div class="profile-card">
                <div class="profile-header">
                    <img id="profilePicLarge" src="" alt="Profile Picture" class="profile-pic-large">
                    <h1 id="profileName">Loading...</h1>
                    <p id="profileEmail">email@example.com</p>
                </div>

                <!-- Account Information - View Mode -->
                <div id="viewMode" class="view-mode">
                    <div class="profile-section">
                        <h2>Account Information</h2>
                        <div class="info-row">
                            <span class="info-label">Full Name</span>
                            <span class="info-value" id="displayName">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Email</span>
                            <span class="info-value" id="displayEmail">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Username</span>
                            <span class="info-value" id="displayUsername">Not set</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Bio</span>
                            <span class="info-value" id="displayBio">No bio yet</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Favorite Beer</span>
                            <span class="info-value" id="displayFavBeer">Not set</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Member Since</span>
                            <span class="info-value" id="displayMemberSince">-</span>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="toggleEditMode()">Edit Profile</button>
                </div>

                <!-- Edit Mode -->
                <div id="editMode" class="edit-mode">
                    <div class="profile-section">
                        <h2>Edit Profile</h2>
                        
                        <div class="form-group">
                            <label for="editUsername">Username</label>
                            <input type="text" id="editUsername" placeholder="Choose a username">
                        </div>

                        <div class="form-group">
                            <label for="editBio">Bio</label>
                            <textarea id="editBio" placeholder="Tell us about yourself..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="editFavBeer">Favorite Beer</label>
                            <input type="text" id="editFavBeer" placeholder="What's your favorite beer?">
                        </div>

                        <div class="form-group">
                            <label for="editBeerStyle">Preferred Beer Style</label>
                            <select id="editBeerStyle">
                                <option value="">Select a style</option>
                                <option value="IPA">IPA</option>
                                <option value="Lager">Lager</option>
                                <option value="Stout">Stout</option>
                                <option value="Ale">Ale</option>
                                <option value="Pilsner">Pilsner</option>
                                <option value="Wheat Beer">Wheat Beer</option>
                                <option value="Porter">Porter</option>
                                <option value="Sour">Sour</option>
                            </select>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="saveProfile()">Save Changes</button>
                    <button class="btn btn-secondary" onclick="toggleEditMode()">Cancel</button>
                </div>
            </div>

            <!-- Stats Card -->
            <div class="profile-card">
                <div class="profile-section">
                    <h2>Your Stats</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="statSessions">1</div>
                            <div class="stat-label">Sessions</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="statBeers">10929</div>
                            <div class="stat-label">Beer Score</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="statDays">1</div>
                            <div class="stat-label">Days Active</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Check authentication
            window.addEventListener('DOMContentLoaded', function() {
                checkAuthentication();
            });

            function checkAuthentication() {
                const token = localStorage.getItem('userToken');
                
                if (!token) {
                    window.location.href = 'login.html';
                } else {
                    loadProfile();
                    displayUserInfo();
                }
            }

            function displayUserInfo() {
                const userName = localStorage.getItem('userName');
                const userPicture = localStorage.getItem('userPicture');
                
                const userInfoDiv = document.getElementById('userInfo');
                if (userInfoDiv) {
                    userInfoDiv.innerHTML = `
                        <img src="${userPicture}" alt="${userName}">
                        <span>${userName}</span>
                        <button onclick="logout()">Logout</button>
                    `;
                }
            }

            function loadProfile() {
                // Get basic Google info
                const userName = localStorage.getItem('userName');
                const userEmail = localStorage.getItem('userEmail');
                const userPicture = localStorage.getItem('userPicture');

                // Get custom profile info
                const username = localStorage.getItem('profile_username') || 'Not set';
                const bio = localStorage.getItem('profile_bio') || 'No bio yet';
                const favBeer = localStorage.getItem('profile_favBeer') || 'Not set';
                const beerStyle = localStorage.getItem('profile_beerStyle') || '';
                const memberSince = localStorage.getItem('profile_memberSince') || new Date().toLocaleDateString();

                // Get stats
                const sessions = localStorage.getItem('stat_sessions') || '0';
                const beers = localStorage.getItem('stat_beers') || '0';
                const days = localStorage.getItem('stat_days') || '0';

                // Display in profile header
                document.getElementById('profilePicLarge').src = userPicture;
                document.getElementById('profileName').textContent = userName;
                document.getElementById('profileEmail').textContent = userEmail;

                // Display in view mode
                document.getElementById('displayName').textContent = userName;
                document.getElementById('displayEmail').textContent = userEmail;
                document.getElementById('displayUsername').textContent = username;
                document.getElementById('displayBio').textContent = bio;
                document.getElementById('displayFavBeer').textContent = favBeer;
                document.getElementById('displayMemberSince').textContent = memberSince;

                // Set stats
                document.getElementById('statSessions').textContent = sessions;
                document.getElementById('statBeers').textContent = beers;
                document.getElementById('statDays').textContent = days;

                // Pre-fill edit form
                document.getElementById('editUsername').value = username === 'Not set' ? '' : username;
                document.getElementById('editBio').value = bio === 'No bio yet' ? '' : bio;
                document.getElementById('editFavBeer').value = favBeer === 'Not set' ? '' : favBeer;
                document.getElementById('editBeerStyle').value = beerStyle;
            }

            function toggleEditMode() {
                const viewMode = document.getElementById('viewMode');
                const editMode = document.getElementById('editMode');
                
                if (editMode.classList.contains('active')) {
                    // Cancel - go back to view mode
                    editMode.classList.remove('active');
                    viewMode.classList.remove('hidden');
                } else {
                    // Enter edit mode
                    viewMode.classList.add('hidden');
                    editMode.classList.add('active');
                }
            }

            function saveProfile() {
                // Get form values
                const username = document.getElementById('editUsername').value.trim();
                const bio = document.getElementById('editBio').value.trim();
                const favBeer = document.getElementById('editFavBeer').value.trim();
                const beerStyle = document.getElementById('editBeerStyle').value;

                // Save to localStorage
                localStorage.setItem('profile_username', username || 'Not set');
                localStorage.setItem('profile_bio', bio || 'No bio yet');
                localStorage.setItem('profile_favBeer', favBeer || 'Not set');
                localStorage.setItem('profile_beerStyle', beerStyle);

                // Set member since if not already set
                if (!localStorage.getItem('profile_memberSince')) {
                    localStorage.setItem('profile_memberSince', new Date().toLocaleDateString());
                }

                // Show success message
                const successMsg = document.getElementById('successMessage');
                successMsg.classList.add('show');
                setTimeout(() => {
                    successMsg.classList.remove('show');
                }, 3000);

                // Reload profile and exit edit mode
                loadProfile();
                toggleEditMode();
            }

            function logout() {
                localStorage.clear();
                window.location.href = 'login.html';
            }

            // Update stats (call this from your main app when users interact)
            function updateStat(statName, value) {
                localStorage.setItem(`stat_${statName}`, value);
            }

            // Example: Increment a stat
            function incrementStat(statName) {
                const current = parseInt(localStorage.getItem(`stat_${statName}`) || '0');
                localStorage.setItem(`stat_${statName}`, (current + 1).toString());
            }
        </script>
    </body>
</html>